<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mensagens Recebidas - Admin | World Inova</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
</head>
<body>
    <header class="header-dark">
        <h2 style="text-align:center; margin:32px 0 24px 0;">Mensagens Recebidas</h2>
    </header>
    <main>
        <div id="mensagens-list" style="max-width:600px;margin:0 auto;"></div>
        <button id="logout-admin" class="btn-dark small" style="margin-top:1rem;display:none;">Sair</button>
    </main>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAbsVCpF09twr4wpCYHB_cbA1oNkCuqtj0",
            authDomain: "site-mundoteknologia.firebaseapp.com",
            projectId: "site-mundoteknologia",
            storageBucket: "site-mundoteknologia.appspot.com",
            messagingSenderId: "171461943616",
            appId: "1:171461943616:web:07cb0ada17038be0641aa5",
            measurementId: "G-EJTL4ERWMP",
            databaseURL: "https://site-mundoteknologia-default-rtdb.firebaseio.com"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        const ADMINS = [
            "Frty58XjXdfYNxh0gquwjgBMEv12",
            "q8CyMhIWREMI6QrZVlUQvFeMQTC2",
            "rPn9EWLFGWRnPbxAm3BTrplK3Wh1"
        ];

        function carregarMensagens() {
            const lista = document.getElementById('mensagens-list');
            lista.innerHTML = "<p>Carregando...</p>";
            onValue(ref(db, 'mensagens'), (snapshot) => {
                let html = "";
                snapshot.forEach(function(child) {
                    const msg = child.val();
                    html += `<div style="border:1px solid #ccc;padding:8px;margin-bottom:8px;">
                        <b>Nome:</b> ${msg.nome || ''}<br>
                        <b>Email:</b> ${msg.email || ''}<br>
                        <b>Mensagem:</b> ${msg.mensagem || ''}<br>
                        <small>${msg.data || ''}</small>
                    </div>`;
                });
                lista.innerHTML = html || "<p>Nenhuma mensagem recebida.</p>";
            });
        }

        onAuthStateChanged(auth, (user) => {
            if (user && ADMINS.includes(user.uid)) {
                document.getElementById('logout-admin').style.display = 'inline-block';
                carregarMensagens();
            } else {
                window.location.href = "index.html#admin";
            }
        });

        document.getElementById('logout-admin').addEventListener('click', function() {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        });
    </script>
</body>
</html>