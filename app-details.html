<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Detalhes do App | WorldInova</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .app-detalhes-container {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            margin: 40px 0;
            gap: 30px;
            flex-wrap: wrap;
        }
        .app-card {
            background: #23272f;
            border-radius: 18px;
            box-shadow: 0 2px 16px #0002;
            padding: 24px 18px;
            width: 340px;
            color: #fff;
            text-align: center;
        }
        .app-card img {
            width: 100%;
            max-width: 220px;
            margin: 0 auto 18px auto;
            border-radius: 12px;
            background: #181a20;
        }
        .app-card input, .app-card textarea {
            width: 100%;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #444;
            padding: 8px;
            background: #181a20;
            color: #fff;
        }
        .app-card label {
            display: block;
            text-align: left;
            margin-bottom: 4px;
            font-size: 0.95em;
            color: #00b4d8;
        }
        .readonly input, .readonly textarea {
            background: #181a20;
            color: #bbb;
            border: none;
            pointer-events: none;
        }
        .btn-dark {
            background: #00b4d8;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.2s;
        }
        .btn-dark:active {
            background: #0090a8;
        }
        .app-card input[type="file"] {
            margin-bottom: 0;
            background: none;
            color: #fff;
            border: none;
        }
    </style>
</head>
<body>
    <header class="header-dark">
        <nav class="nav-dark">
            <div class="logo-dark">WorldInova</div>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#portfolio">Portfólio</a></li>
                <li><a href="index.html#about">Sobre</a></li>
                <li><a href="index.html#contact">Contato</a></li>
                <li><a href="index.html#admin" id="admin-btn">Admin</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h2 style="text-align:center;margin:32px 0 12px 0;">Detalhes do App</h2>
        <div class="app-detalhes-container" id="detalhes-apps">
            <!-- Cards dos apps serão inseridos via JS -->
        </div>
    </main>

    <footer class="footer-dark">
        <p>&copy; 2025 WorldInova. Todos os direitos reservados.</p>
    </footer>
    <script type="module">
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAbsVCpF09twr4wpCYHB_cbA1oNkCuqtj0",
        authDomain: "site-mundoteknologia.firebaseapp.com",
        projectId: "site-mundoteknologia",
        storageBucket: "site-mundoteknologia.appspot.com",
        messagingSenderId: "171461943616",
        appId: "1:171461943616:web:07cb0ada17038be0641aa5",
        measurementId: "G-EJTL4ERWMP",
        databaseURL: "https://site-mundoteknologia-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const ADMINS = [
        "wesleicostabbs@hotmail.com",
        "mundoteknologia@gmail.com",
        "alandigdez@gmail.com"
    ];

    // Carrega apps do banco de dados
    function loadApps(callback) {
        onValue(ref(db, 'apps'), (snapshot) => {
            const data = snapshot.val();
            let apps = [];
            if (data) {
                apps = Object.keys(data).map(id => ({
                    id,
                    ...data[id]
                }));
            }
            callback(apps);
        });
    }

    // Salva app no banco de dados
    function saveApp(app) {
        return set(ref(db, 'apps/' + app.id), app);
    }

    // Salva imagem no banco de dados (base64)
    function handleImageUpload(file, cb) {
        const reader = new FileReader();
        reader.onload = function(e) {
            cb(e.target.result);
        };
        reader.readAsDataURL(file);
    }

    function renderCards(apps, isAdmin) {
        const container = document.getElementById('detalhes-apps');
        container.innerHTML = "";
        apps.forEach((app, idx) => {
            container.innerHTML += `
            <div class="app-card${!isAdmin ? ' readonly' : ''}" data-id="${app.id}">
                <label>Nome do APP</label>
                <input type="text" value="${app.nome || ''}" ${!isAdmin ? 'readonly' : ''} />
                <label>Descrição do APP</label>
                <textarea rows="2" ${!isAdmin ? 'readonly' : ''}>${app.descricao || ''}</textarea>
                <label>Inserir foto</label>
                <img src="${app.img || 'images/placeholder.png'}" alt="App" onerror="this.src='images/placeholder.png'">
                ${isAdmin ? '<input type="file" accept="image/*" />' : ''}
                <label>Detalhes App</label>
                <textarea rows="3" ${!isAdmin ? 'readonly' : ''}>${app.detalhes || ''}</textarea>
                ${isAdmin ? '<button class="btn-dark save-btn">Salvar</button>' : ''}
            </div>
            `;
        });

        // Eventos de edição e upload (apenas admin)
        if (isAdmin) {
            document.querySelectorAll('.app-card').forEach((card, idx) => {
                const id = card.getAttribute('data-id');
                const nomeInput = card.querySelector('input[type="text"]');
                const descTextarea = card.querySelectorAll('textarea')[0];
                const detalhesTextarea = card.querySelectorAll('textarea')[1];
                const imgTag = card.querySelector('img');
                const fileInput = card.querySelector('input[type="file"]');
                const saveBtn = card.querySelector('.save-btn');

                // Salva ao clicar no botão
                if (saveBtn) {
                    saveBtn.addEventListener('click', () => {
                        const updated = {
                            id,
                            nome: nomeInput.value,
                            descricao: descTextarea.value,
                            detalhes: detalhesTextarea.value,
                            img: imgTag.src
                        };
                        saveApp(updated).then(() => {
                            saveBtn.textContent = "Salvo!";
                            setTimeout(() => saveBtn.textContent = "Salvar", 1200);
                        });
                    });
                }

                // Salva ao trocar imagem (imagem só é salva ao clicar em salvar)
                if (fileInput) {
                    fileInput.addEventListener('change', function() {
                        if (fileInput.files && fileInput.files[0]) {
                            handleImageUpload(fileInput.files[0], (base64) => {
                                imgTag.src = base64;
                            });
                        }
                    });
                }
            });
        }
    }

    // Detecta admin logado e carrega apps
    onAuthStateChanged(auth, user => {
        let isAdmin = false;
        if (user && ADMINS.includes(user.email)) {
            isAdmin = true;
        }
        loadApps(apps => {
            // Se não houver apps, cria 3 exemplos
            if (apps.length === 0 && isAdmin) {
                const exemplos = [
                    { id: "app1", nome: "Nome do APP", descricao: "Descrição do APP", img: "", detalhes: "Detalhes App" },
                    { id: "app2", nome: "Nome do APP", descricao: "Descrição do APP", img: "", detalhes: "Detalhes App" },
                    { id: "app3", nome: "Nome do APP", descricao: "Descrição do APP", img: "", detalhes: "Detalhes App" }
                ];
                exemplos.forEach(saveApp);
                renderCards(exemplos, isAdmin);
            } else {
                renderCards(apps, isAdmin);
            }
        });
    });
    </script>
</body>
</html>