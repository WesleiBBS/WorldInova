<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Detalhes do App | WorldInova</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            background: #181a20;
            font-family: 'Poppins', 'Inter', Arial, sans-serif;
        }
        .app-detalhes-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin: 40px 0;
            gap: 40px;
            flex-wrap: wrap;
        }
        .app-card {
            background: #23272f;
            border-radius: 18px;
            box-shadow: 0 2px 24px #0004;
            padding: 32px 24px 24px 24px;
            width: 370px;
            color: #fff;
            text-align: center;
            transition: box-shadow 0.2s;
            position: relative;
        }
        .app-card:hover {
            box-shadow: 0 4px 32px #00b4d855;
        }
        .app-card label {
            display: block;
            text-align: left;
            margin-bottom: 4px;
            font-size: 1em;
            color: #00b4d8;
            font-weight: 600;
        }
        .app-card input, .app-card textarea {
            width: 100%;
            margin-bottom: 14px;
            border-radius: 8px;
            border: 1px solid #444;
            padding: 10px;
            background: #181a20;
            color: #fff;
            font-size: 1em;
            font-family: inherit;
            transition: border 0.2s;
        }
        .app-card input:focus, .app-card textarea:focus {
            border: 1.5px solid #00b4d8;
            outline: none;
        }
        .readonly input, .readonly textarea {
            background: #181a20;
            color: #bbb;
            border: none;
            pointer-events: none;
        }
        .app-card .image-preview {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }
        .app-card .image-preview img {
            width: 110px;
            height: 170px;
            object-fit: cover;
            border-radius: 10px;
            background: #181a20;
            border: 2px solid #222;
            box-shadow: 0 2px 8px #0002;
            transition: transform 0.3s cubic-bezier(.4,2,.6,1), box-shadow 0.3s;
            cursor: pointer;
        }
        .app-card .image-preview img:hover {
            transform: scale(1.35);
            z-index: 10;
            box-shadow: 0 8px 32px #00b4d8aa, 0 2px 8px #0004;
        }
        .app-card .remove-img-btn {
            display: inline-block;
            background: #ff5252;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 1em;
            position: absolute;
            right: 8px;
            top: 8px;
            cursor: pointer;
            z-index: 2;
        }
        .btn-dark {
            background: #00b4d8;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 0;
            font-weight: 700;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 12px;
            width: 100%;
            transition: background 0.2s;
        }
        .btn-dark:active {
            background: #0090a8;
        }
        .app-card input[type="file"] {
            margin-bottom: 0;
            background: none;
            color: #fff;
            border: none;
        }
        .app-card .img-upload-label {
            color: #00b4d8;
            font-size: 0.98em;
            font-weight: 500;
            margin-bottom: 6px;
            display: block;
            text-align: left;
        }
        .add-app-btn {
            background: #00b4d8;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px 32px;
            font-weight: 700;
            font-size: 1.1em;
            cursor: pointer;
            margin: 0 auto 32px auto;
            display: block;
            transition: background 0.2s;
        }
        .add-app-btn:active {
            background: #0090a8;
        }
        @media (max-width: 1100px) {
            .app-detalhes-container {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <header class="header-dark">
        <nav class="nav-dark">
            <div class="logo-dark">WorldInova</div>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#portfolio">Portfólio</a></li>
                <li><a href="index.html#about">Sobre</a></li>
                <li><a href="index.html#contact">Contato</a></li>
                <li><a href="index.html#admin" id="admin-btn">Admin</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h2 style="text-align:center;margin:32px 0 24px 0;font-size:2.1em;">Detalhes do App</h2>
        <button id="add-app-btn" class="add-app-btn" style="display:none;">Adicionar Novo App</button>
        <div class="app-detalhes-container" id="detalhes-apps">
            <!-- Cards dos apps serão inseridos via JS -->
        </div>
    </main>

    <footer class="footer-dark">
        <p>&copy; 2025 WorldInova. Todos os direitos reservados.</p>
    </footer>
    <script type="module">
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAbsVCpF09twr4wpCYHB_cbA1oNkCuqtj0",
        authDomain: "site-mundoteknologia.firebaseapp.com",
        projectId: "site-mundoteknologia",
        storageBucket: "site-mundoteknologia.appspot.com",
        messagingSenderId: "171461943616",
        appId: "1:171461943616:web:07cb0ada17038be0641aa5",
        measurementId: "G-EJTL4ERWMP",
        databaseURL: "https://site-mundoteknologia-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const ADMINS = [
        "wesleicostabbs@hotmail.com",
        "mundoteknologia@gmail.com",
        "alandigdez@gmail.com"
    ];

    // Carrega apps do banco de dados
    function loadApps(callback) {
        onValue(ref(db, 'apps'), (snapshot) => {
            const data = snapshot.val();
            let apps = [];
            if (data) {
                apps = Object.keys(data).map(id => ({
                    id,
                    ...data[id]
                }));
            }
            callback(apps);
        });
    }

    // Salva app no banco de dados
    function saveApp(app) {
        return set(ref(db, 'apps/' + app.id), app);
    }

    // Cria novo app no banco de dados
    function createApp(app, cb) {
        const newRef = push(ref(db, 'apps'));
        app.id = newRef.key;
        set(newRef, app).then(() => cb && cb(app));
    }

    // Remove app do banco de dados
    function deleteApp(appId) {
        return remove(ref(db, 'apps/' + appId));
    }

    // Salva imagem no banco de dados (base64)
    function handleImageUpload(file, cb) {
        const reader = new FileReader();
        reader.onload = function(e) {
            cb(e.target.result);
        };
        reader.readAsDataURL(file);
    }

    function renderCards(apps, isAdmin) {
        const container = document.getElementById('detalhes-apps');
        container.innerHTML = "";
        apps.slice(0, 6).forEach((app, idx) => {
            let img = app.img || 'images/placeholder.png';
            container.innerHTML += `
            <div class="app-card${!isAdmin ? ' readonly' : ''}" data-id="${app.id}">
                <label>Nome do APP</label>
                <input type="text" value="${app.nome || ''}" ${!isAdmin ? 'readonly' : ''} />
                <label>Descrição do APP</label>
                <textarea rows="2" ${!isAdmin ? 'readonly' : ''}>${app.descricao || ''}</textarea>
                <div class="image-preview">
                    <img src="${img}" alt="App" onerror="this.src='images/placeholder.png'">
                    ${isAdmin && img !== 'images/placeholder.png' ? `<button class="remove-img-btn" title="Remover imagem">&times;</button>` : ''}
                </div>
                ${isAdmin ? `
                    <label class="img-upload-label">Adicionar/Alterar imagem</label>
                    <input type="file" accept="image/*" />
                ` : ''}
                <label>Detalhes App</label>
                <textarea rows="3" ${!isAdmin ? 'readonly' : ''}>${app.detalhes || ''}</textarea>
                ${isAdmin ? `
                    <button class="btn-dark save-btn">Salvar</button>
                    <button class="btn-dark delete-btn" style="background:#ff5252;margin-top:8px;">Excluir Card</button>
                ` : ''}
            </div>
            `;
        });

        // Eventos de edição e upload (apenas admin)
        if (isAdmin) {
            document.querySelectorAll('.app-card').forEach((card, idx) => {
                const id = card.getAttribute('data-id');
                const nomeInput = card.querySelector('input[type="text"]');
                const descTextarea = card.querySelectorAll('textarea')[0];
                const detalhesTextarea = card.querySelectorAll('textarea')[1];
                const imgTag = card.querySelector('.image-preview img');
                const fileInput = card.querySelector('input[type="file"]');
                const saveBtn = card.querySelector('.save-btn');
                const deleteBtn = card.querySelector('.delete-btn');
                const removeImgBtn = card.querySelector('.remove-img-btn');

                // Remover imagem
                if (removeImgBtn) {
                    removeImgBtn.addEventListener('click', function() {
                        imgTag.src = 'images/placeholder.png';
                    });
                }

                // Upload de imagem
                if (fileInput) {
                    fileInput.addEventListener('change', function() {
                        if (fileInput.files && fileInput.files[0]) {
                            handleImageUpload(fileInput.files[0], (base64) => {
                                imgTag.src = base64;
                            });
                        }
                    });
                }

                // Salvar alterações
                if (saveBtn) {
                    saveBtn.addEventListener('click', () => {
                        const updated = {
                            id,
                            nome: nomeInput.value,
                            descricao: descTextarea.value,
                            detalhes: detalhesTextarea.value,
                            img: imgTag.src
                        };
                        saveApp(updated).then(() => {
                            saveBtn.textContent = "Salvo!";
                            setTimeout(() => saveBtn.textContent = "Salvar", 1200);
                        });
                    });
                }

                // Excluir card/app
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', () => {
                        if (confirm('Tem certeza que deseja excluir este card?')) {
                            deleteApp(id);
                        }
                    });
                }
            });
        }
    }

    // Detecta admin logado e carrega apps
    let isAdminGlobal = false;
    onAuthStateChanged(auth, user => {
        let isAdmin = false;
        if (user && ADMINS.includes(user.email)) {
            isAdmin = true;
        }
        isAdminGlobal = isAdmin;
        document.getElementById('add-app-btn').style.display = isAdmin ? 'block' : 'none';
        loadApps(apps => {
            renderCards(apps, isAdmin);
        });
    });

    // Adicionar novo app (máximo 6)
    document.getElementById('add-app-btn').addEventListener('click', function() {
        loadApps(apps => {
            if (apps.length >= 6) {
                alert('Limite de 6 cards atingido.');
                return;
            }
            createApp({
                nome: "Nome do APP",
                descricao: "Descrição do APP",
                img: "",
                detalhes: "Detalhes App"
            });
        });
    });
    </script>
</body>
</html>